<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title>공연 검색 및 추천 관리</title>-->
<!--    <meta charset="UTF-8" />-->
<!--    <style>-->
<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            margin: 40px;-->
<!--            background-color: #f9f9f9;-->
<!--            color: #333;-->
<!--        }-->

<!--        h2 {-->
<!--            margin-top: 40px;-->
<!--            color: #444;-->
<!--            border-bottom: 2px solid #ddd;-->
<!--            padding-bottom: 5px;-->
<!--        }-->

<!--        form {-->
<!--            margin-bottom: 30px;-->
<!--            background: #fff;-->
<!--            padding: 20px;-->
<!--            border-radius: 8px;-->
<!--            box-shadow: 0 2px 8px rgba(0,0,0,0.05);-->
<!--        }-->

<!--        input[type="text"] {-->
<!--            padding: 10px;-->
<!--            width: 60%;-->
<!--            border: 1px solid #ccc;-->
<!--            border-radius: 4px;-->
<!--            font-size: 16px;-->
<!--            margin-right: 10px;-->
<!--        }-->

<!--        button {-->
<!--            padding: 10px 20px;-->
<!--            background-color: #2a9d8f;-->
<!--            color: white;-->
<!--            border: none;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--            font-size: 15px;-->
<!--            transition: background-color 0.3s ease;-->
<!--        }-->

<!--        button:hover {-->
<!--            background-color: #21867a;-->
<!--        }-->

<!--        ul {-->
<!--            list-style: none;-->
<!--            padding-left: 0;-->
<!--            margin-top: 10px;-->
<!--        }-->

<!--        li {-->
<!--            margin: 10px 0;-->
<!--            padding: 8px 12px;-->
<!--            background: #f0f0f0;-->
<!--            border-radius: 4px;-->
<!--            transition: background-color 0.2s;-->
<!--        }-->

<!--        li:hover {-->
<!--            background-color: #e6e6e6;-->
<!--        }-->

<!--        label {-->
<!--            cursor: pointer;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--        }-->

<!--        input[type="checkbox"] {-->
<!--            margin-right: 10px;-->
<!--        }-->

<!--        hr {-->
<!--            margin: 50px 0;-->
<!--            border: none;-->
<!--            border-top: 1px solid #ccc;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h2>공연 검색</h2>-->

<!--<form id="search-form">-->
<!--    <input type="text" id="search-input" placeholder="공연명 검색어 입력" required />-->
<!--    <button type="submit">검색</button>-->
<!--</form>-->

<!--<hr/>-->

<!--<h2>검색 결과</h2>-->
<!--<div>-->
<!--    <form id="recommend-form">-->
<!--        <ul id="search-results">-->
<!--            <li>검색어를 입력하고 검색 버튼을 누르세요.</li>-->
<!--        </ul>-->
<!--        <button type="submit">선택한 공연 추천 등록</button>-->
<!--    </form>-->
<!--</div>-->

<!--<hr/>-->

<!--<h2>현재 추천된 공연 목록</h2>-->
<!--<form id="delete-form">-->
<!--    <ul id="recommended-performances">-->
<!--        <li>추천된 공연 목록을 불러오는 중입니다...</li>-->
<!--    </ul>-->
<!--    <button type="submit">선택한 추천 공연 삭제</button>-->
<!--</form>-->

<!--<script th:inline="javascript">-->
<!--    const adminId = /*[[${token}]]*/ '';-->
<!--</script>-->

<!--<script>-->
<!--    // 추천 공연 목록 불러오기-->
<!--    async function fetchRecommendedPerformances() {-->
<!--        try {-->
<!--            const res = await fetch('/performances/custom');-->
<!--            const data = await res.json();-->

<!--            const list = document.getElementById('recommended-performances');-->
<!--            list.innerHTML = '';-->

<!--            if (data.length === 0) {-->
<!--                list.innerHTML = '<li>현재 추천된 공연이 없습니다.</li>';-->
<!--                return;-->
<!--            }-->

<!--            data.forEach(perf => {-->
<!--                const li = document.createElement('li');-->
<!--                li.innerHTML = `-->
<!--                    <label>-->
<!--                        <input type="checkbox" name="performanceIds" value="${perf.id}" />-->
<!--                        ${perf.performanceName}-->
<!--                    </label>-->
<!--                `;-->
<!--                list.appendChild(li);-->
<!--            });-->
<!--        } catch (err) {-->
<!--            alert('추천 공연 목록 불러오기 실패: ' + err.message);-->
<!--        }-->
<!--    }-->

<!--    // 공연 검색 결과 보여주기-->
<!--    async function searchPerformances(keyword) {-->
<!--        try {-->
<!--            const res = await fetch(`/performances/search?search=${encodeURIComponent(keyword)}`);-->
<!--            const data = await res.json();-->

<!--            const list = document.getElementById('search-results');-->
<!--            list.innerHTML = '';-->

<!--            if (data.length === 0) {-->
<!--                list.innerHTML = '<li>검색 결과가 없습니다.</li>';-->
<!--                return;-->
<!--            }-->

<!--            data.forEach(perf => {-->
<!--                const li = document.createElement('li');-->
<!--                li.innerHTML = `-->
<!--                    <label>-->
<!--                        <input type="checkbox" name="performanceIds" value="${perf.id}" />-->
<!--                        ${perf.performanceName}-->
<!--                    </label>-->
<!--                `;-->
<!--                list.appendChild(li);-->
<!--            });-->
<!--        } catch (err) {-->
<!--            alert('검색 실패: ' + err.message);-->
<!--        }-->
<!--    }-->

<!--    // 검색 폼 제출 처리 (검색 API 호출)-->
<!--    document.getElementById('search-form').addEventListener('submit', async function(e) {-->
<!--        e.preventDefault();-->
<!--        const keyword = document.getElementById('search-input').value.trim();-->
<!--        if (!keyword) {-->
<!--            alert('검색어를 입력하세요.');-->
<!--            return;-->
<!--        }-->
<!--        await searchPerformances(keyword);-->
<!--    });-->

<!--    // 추천 공연 등록-->
<!--    document.getElementById('recommend-form').addEventListener('submit', async function(e) {-->
<!--        e.preventDefault();-->

<!--        // 검색 결과에서 선택된 공연 ID 수집-->
<!--        const checked = document.querySelectorAll('#search-results input[name="performanceIds"]:checked');-->
<!--        if (checked.length === 0) {-->
<!--            alert('추천 등록할 공연을 하나 이상 선택해주세요.');-->
<!--            return;-->
<!--        }-->

<!--        const ids = Array.from(checked).map(cb => Number(cb.value));-->
<!--        const payload = { performanceIds: ids };-->

<!--        try {-->
<!--            const res = await fetch('/performances/custom', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json',-->
<!--                    'Authorization': `Bearer ${adminId}`-->
<!--                },-->
<!--                body: JSON.stringify(payload)-->
<!--            });-->

<!--            if (res.ok) {-->
<!--                alert('추천 공연이 등록되었습니다.');-->
<!--                // 추천 공연 목록 갱신 + 검색 결과 체크박스 해제-->
<!--                await fetchRecommendedPerformances();-->
<!--                document.getElementById('recommend-form').reset();-->
<!--            } else {-->
<!--                const msg = await res.text();-->
<!--                alert('추천 등록 실패: ' + msg);-->
<!--            }-->
<!--        } catch (err) {-->
<!--            alert('추천 등록 요청 실패: ' + err.message);-->
<!--        }-->
<!--    });-->

<!--    // 추천 공연 삭제-->
<!--    document.getElementById('delete-form').addEventListener('submit', async function(e) {-->
<!--        e.preventDefault();-->

<!--        // 추천 공연 목록에서 선택된 공연 ID 수집-->
<!--        const checked = document.querySelectorAll('#recommended-performances input[name="performanceIds"]:checked');-->
<!--        if (checked.length === 0) {-->
<!--            alert('삭제할 추천 공연을 하나 이상 선택해주세요.');-->
<!--            return;-->
<!--        }-->

<!--        const ids = Array.from(checked).map(cb => Number(cb.value));-->
<!--        const payload = { performanceIds: ids };-->

<!--        try {-->
<!--            const res = await fetch('/performances/custom', {-->
<!--                method: 'DELETE',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json',-->
<!--                    'Authorization': `Bearer ${adminId}`-->
<!--                },-->
<!--                body: JSON.stringify(payload)-->
<!--            });-->

<!--            if (res.ok) {-->
<!--                alert('추천 공연이 삭제되었습니다.');-->
<!--                await fetchRecommendedPerformances();-->
<!--            } else {-->
<!--                const msg = await res.text();-->
<!--                alert('삭제 실패: ' + msg);-->
<!--            }-->
<!--        } catch (err) {-->
<!--            alert('삭제 요청 실패: ' + err.message);-->
<!--        }-->
<!--    });-->

<!--    // 초기 로드 시 추천 공연 목록 가져오기-->
<!--    document.addEventListener('DOMContentLoaded', fetchRecommendedPerformances);-->
<!--</script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>공연 검색 및 추천 관리</title>
    <meta charset="UTF-8" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
            color: #333;
        }

        h2 {
            margin-top: 40px;
            color: #444;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }

        form {
            margin-bottom: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        input[type="text"] {
            padding: 10px;
            width: 60%;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            margin-right: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: #2a9d8f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #21867a;
        }

        ul {
            list-style: none;
            padding-left: 0;
            margin-top: 10px;
        }

        li {
            margin: 10px 0;
            padding: 8px 12px;
            background: #f0f0f0;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        li:hover {
            background-color: #e6e6e6;
        }

        label {
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        input[type="checkbox"] {
            margin-right: 10px;
        }

        hr {
            margin: 50px 0;
            border: none;
            border-top: 1px solid #ccc;
        }

        /* --- 인기 공연 목록 스타일 수정 --- */
        #popular-performances-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
            padding: 0;
        }

        #popular-performances-list li {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 0; /* 패딩을 a 태그로 이동 */
            margin: 0;
            text-align: left;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden; /* a 태그가 li 밖으로 나가지 않도록 */
        }

        #popular-performances-list li:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        #popular-performances-list .perf-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        #popular-performances-list img {
            width: 100%;
            display: block;
            border-bottom: 1px solid #eee;
            aspect-ratio: 2 / 3;
            object-fit: cover;
            background-color: #f0f0f0;
        }

        #popular-performances-list .perf-info {
            padding: 12px;
        }

        #popular-performances-list .perf-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
            /* 긴 텍스트 자르기 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #popular-performances-list .perf-details {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        #popular-performances-list .perf-details span {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

    </style>
</head>
<body>

<!-- ======================= 인기 공연 섹션 ======================= -->
<h2>인기 공연 목록 (상위 6개)</h2>
<ul id="popular-performances-list">
    <li>인기 공연 목록을 불러오는 중입니다...</li>
</ul>
<hr/>
<!-- =============================================================== -->


<h2>공연 검색</h2>
<form id="search-form">
    <input type="text" id="search-input" placeholder="공연명 검색어 입력" required />
    <button type="submit">검색</button>
</form>

<hr/>

<h2>검색 결과</h2>
<div>
    <form id="recommend-form">
        <ul id="search-results">
            <li>검색어를 입력하고 검색 버튼을 누르세요.</li>
        </ul>
        <button type="submit">선택한 공연 추천 등록</button>
    </form>
</div>

<hr/>

<h2>현재 추천된 공연 목록</h2>
<form id="delete-form">
    <ul id="recommended-performances">
        <li>추천된 공연 목록을 불러오는 중입니다...</li>
    </ul>
    <button type="submit">선택한 추천 공연 삭제</button>
</form>

<script th:inline="javascript">
    const adminId = /*[[${token}]]*/ '';
</script>

<script>
    /**
     * @apiNote 인기 공연 6개를 조회하고, DTO 기반으로 상세 정보를 화면에 표시합니다.
     */
    async function fetchPopularPerformances() {
        try {
            const res = await fetch('/performances/popular');
            if (!res.ok) {
                throw new Error(`서버 응답 오류: ${res.status}`);
            }
            const data = await res.json();

            const list = document.getElementById('popular-performances-list');
            list.innerHTML = '';

            if (!data || data.length === 0) {
                list.innerHTML = '<li>인기 공연 정보가 없습니다.</li>';
                return;
            }

            data.forEach(perf => {
                const li = document.createElement('li');

                // DTO 필드를 사용하여 HTML 구조 생성
                // ticketLink가 있으면 a 태그로 감싸고, 없으면 div로 감싼다.
                const content = `
                    <img src="${perf.poster}"
                         alt="${perf.performanceName} 포스터"
                         onerror="this.onerror=null; this.src='https://placehold.co/400x600/EFEFEF/AAAAAA?text=No+Image';">
                    <div class="perf-info">
                        <div class="perf-name" title="${perf.performanceName}">${perf.performanceName}</div>
                        <div class="perf-details">
                            <span title="${perf.venue}">📍 ${perf.venue}</span>
                            <span>🗓️ ${perf.startDate} ~ ${perf.endDate}</span>
                        </div>
                    </div>
                `;

                if (perf.ticketLink) {
                    li.innerHTML = `<a href="${perf.ticketLink}" target="_blank" rel="noopener noreferrer" class="perf-link">${content}</a>`;
                } else {
                    li.innerHTML = content;
                }

                list.appendChild(li);
            });

        } catch (err) {
            const list = document.getElementById('popular-performances-list');
            list.innerHTML = `<li>인기 공연 목록을 불러오지 못했습니다: ${err.message}</li>`;
            console.error('인기 공연 로딩 실패:', err);
        }
    }


    // 추천 공연 목록 불러오기
    async function fetchRecommendedPerformances() {
        try {
            const res = await fetch('/performances/custom');
            const data = await res.json();

            const list = document.getElementById('recommended-performances');
            list.innerHTML = '';

            if (data.length === 0) {
                list.innerHTML = '<li>현재 추천된 공연이 없습니다.</li>';
                return;
            }

            data.forEach(perf => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <label>
                        <input type="checkbox" name="performanceIds" value="${perf.id}" />
                        ${perf.performanceName}
                    </label>
                `;
                list.appendChild(li);
            });
        } catch (err) {
            alert('추천 공연 목록 불러오기 실패: ' + err.message);
        }
    }

    // 공연 검색 결과 보여주기
    async function searchPerformances(keyword) {
        try {
            const res = await fetch(`/performances/search?keyword=${encodeURIComponent(keyword)}`);
            const data = await res.json();

            const list = document.getElementById('search-results');
            list.innerHTML = '';

            if (data.length === 0) {
                list.innerHTML = '<li>검색 결과가 없습니다.</li>';
                return;
            }

            data.forEach(perf => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <label>
                        <input type="checkbox" name="performanceIds" value="${perf.id}" />
                        ${perf.performanceName}
                    </label>
                `;
                list.appendChild(li);
            });
        } catch (err) {
            alert('검색 실패: ' + err.message);
        }
    }

    // 검색 폼 제출 처리 (검색 API 호출)
    document.getElementById('search-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const keyword = document.getElementById('search-input').value.trim();
        if (!keyword) {
            alert('검색어를 입력하세요.');
            return;
        }
        await searchPerformances(keyword);
    });

    // 추천 공연 등록
    document.getElementById('recommend-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const checked = document.querySelectorAll('#search-results input[name="performanceIds"]:checked');
        if (checked.length === 0) {
            alert('추천 등록할 공연을 하나 이상 선택해주세요.');
            return;
        }

        const ids = Array.from(checked).map(cb => Number(cb.value));
        const payload = { performanceIds: ids };

        try {
            const res = await fetch('/performances/custom', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminId}`
                },
                body: JSON.stringify(payload)
            });

            if (res.ok) {
                alert('추천 공연이 등록되었습니다.');
                await fetchRecommendedPerformances();
                document.getElementById('recommend-form').reset();
            } else {
                const msg = await res.text();
                alert('추천 등록 실패: ' + msg);
            }
        } catch (err) {
            alert('추천 등록 요청 실패: ' + err.message);
        }
    });

    // 추천 공연 삭제
    document.getElementById('delete-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const checked = document.querySelectorAll('#recommended-performances input[name="performanceIds"]:checked');
        if (checked.length === 0) {
            alert('삭제할 추천 공연을 하나 이상 선택해주세요.');
            return;
        }

        const ids = Array.from(checked).map(cb => Number(cb.value));
        const payload = { performanceIds: ids };

        try {
            const res = await fetch('/performances/custom', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminId}`
                },
                body: JSON.stringify(payload)
            });

            if (res.ok) {
                alert('추천 공연이 삭제되었습니다.');
                await fetchRecommendedPerformances();
            } else {
                const msg = await res.text();
                alert('삭제 실패: ' + msg);
            }
        } catch (err) {
            alert('삭제 요청 실패: ' + err.message);
        }
    });

    // 초기 로드 시 추천 및 인기 공연 목록 가져오기
    document.addEventListener('DOMContentLoaded', () => {
        fetchPopularPerformances();
        fetchRecommendedPerformances();
    });
</script>
</body>
</html>
